---
title: 03-中间件
date: 2024/07/30
---



## 中间件简介

中间件（英语：Middleware）顾名思义是系统软件和用户应用软件之间连接的软件，以便于软件各部件之间的沟通，特别是应用软件对于系统软件的集中的逻辑，是一种独立的系统软件或服务程序，分布式应用软件借助这种软件在不同的技术之间共享资源。中间件在客户服务器的操作系统、网络和数据库之上，管理计算资源和网络通信。总的作用是为处于自己上层的应用软件提供运行与开发的环境，帮助用户灵活、高效地开发和集成复杂的应用软件。

 

自定义中间件

```javascript
//全局中间件
app.use(function (req, res, next) {
  console.log('LOGGED')
    //给req添加一个属性
  req.requestTime = Date.now()
  next()
})

app.get('/', function (req, res) {
  var responseText = 'Hello World!<br>'
  //这里可以访问中间件添加的属性
  responseText += '<small>Requested at: ' + req.requestTime + '</small>'
  res.send(responseText)
})
```



开放跨域请求

```javascript
app.use(function (req, res, next) {
  //设置允许跨域的域名，*代表允许任意域名跨域
  res.header("Access-Control-Allow-Origin", "*");
  //允许的header类型
  res.header("Access-Control-Allow-Headers", "content-type");
  //跨域允许的请求方式
  res.header("Access-Control-Allow-Methods", "DELETE,PUT,POST,GET,OPTIONS");
  if (req.method == "OPTIONS") res.sendStatus(200); //让options尝试请求快速结束
  else next();
});
```



#### Express 自带中间件

<https://www.expressjs.com.cn/4x/api.html#express>

1. json格式数据中间件，它使用JSON有效载荷解析传入请求，并且基于身体解析器。

返回只解析JSON的中间件，并且只查看Content-Type报头与type选项匹配的请求。

​	express.json()

2. 静态文件中间件

   express.static()

3. 路由中间件

   express.Router()



## 路由中间件

所有路由请求如果都写在app.js 会显得冗余，我们需要把不用逻辑的路由抽取到不用的js文件中去，增加可读性和减少耦合度。

创建文件`./routerTestRouter.js`文件

编写路由：

```javascript
const express = require("express");
var router = express.Router();

//get请求接口
router.get("/test", function (req, res) {
  res.send(req.body);
});

module.exports = router;
```



`app.js`加入下列代码

```javascript
//把TestRouter路由添加到app中。
app.use("/test", require("./router/TestRouter"));
// 路由中的 /test 接口，访问路径 -> /test/test
```



























