---
title: 04-文件的上传和下载
date: 2024/07/30
---



## 一.上传文件

安装上传文件中间件

>  npm install multer

 

配置文件上传临时目录

```javascript
const upload = multer({
  dest: "./public/upload/temp",
});
//所有接口都允许有上传功能
app.use(upload.any());
```



上传接口代码:

``` javascript
router.post("/upload", (req, res) => {
  //检测是否有文件
  if (!req.files) {
    res.send({
      code: 400,
      msg: "上传文件不能为空",
    });
    return;
  }
  
  //保存文件
  let files = req.files;
  let ret_files = [];
  for (let file of files) {
    //获取名字后缀
    let file_ext = file.originalname.substring(file.originalname.lastIndexOf(".") + 1);
    //使用时间戳作为文件名字
    let file_name = new Date().getTime() + "." + file_ext;
    // 移动文件并且修改文件名字
    fs.renameSync(
      process.cwd() + "/public/upload/temp/" + file.filename,
      process.cwd() + "/public/upload/" + file_name
    );
    ret_files.push("/public/upload/" + file_name);
  }

  res.send({
    code: 200,
    msg: "ok",
    data: ret_files,
  });
    
}
```



## 二.文件下载

使用res.download()方法

```javascript
//下载文件
router.get("/download", async (req, res) => {
  let file_name = req.query.file_name;
  let file_path = process.cwd() + "/public/upload/" + file_name;
  res.download(file_path);
})
```

























