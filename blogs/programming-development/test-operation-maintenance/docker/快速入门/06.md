---
title: éƒ¨ç½²è‡ªå·±çš„åº”ç”¨
date: 2024/03/29
---

æœ¬ä¾‹å­æˆ‘ä»¬ä½¿ç”¨dockeræ¥éƒ¨ç½²ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿï¼ŒRuoYiæ˜¯ä¸€æ¬¾ç”¨javaç¼–å†™çš„ï¼ŒåŸºäºSpringBoot+Bootstrapçš„åå°ç®¡ç†ç³»ç»Ÿã€‚

ruoyiå®˜æ–¹æ–‡æ¡£ï¼šhttp://doc.ruoyi.vip/ruoyi/

æºç ä¸‹è½½ï¼šhttps://gitee.com/y_project/RuoYi/tree/v4.7.4/

å°†æºç ç¼–è¯‘æ‰“åŒ…æˆruoyi-admin.jaræ–‡ä»¶ï¼Œæ”¾åˆ°å®¿ä¸»æœº/home/appç›®å½•ä¸‹ï¼Œ/home/app/sqlç›®å½•ä¸‹æ˜¯æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ã€‚

é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹äº†ç«¯å£ã€æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚

``` yaml
#application.yml
server:
  # æœåŠ¡å™¨çš„HTTPç«¯å£ï¼Œé»˜è®¤ä¸º80
  port: 8080

---
#application-druid.yml
	url: jdbc:mysql://ruoyi-db:3306/ry?useUnicode=true&characterEncoding=utf8
  username: root
  password: 123456
```

åˆ›å»ºç½‘ç»œå’Œå­˜å‚¨å·

``` nginx
docker volume create ruoyi-data
docker network create ruoyi-net
```

## éƒ¨ç½²mysqlå¹¶åˆå§‹åŒ–æ•°æ®åº“

æˆ‘ä»¬åœ¨åˆ›å»ºæ•°æ®åº“å®¹å™¨çš„æ—¶å€™ï¼Œéœ€è¦åšä¸‰ä»¶äº‹ï¼š

- åˆ›å»ºæ•°æ®åº“`ry`
- è®¾ç½®å­—ç¬¦é›†ä¸º`utf-8`
- æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

ä½¿ç”¨`MYSQL_DATABASE`ç¯å¢ƒå˜é‡åˆ›å»ºæ•°æ®åº“

è®¾ç½®å­—ç¬¦é›†`--character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci`

å®¹å™¨ä½¿ç”¨`/docker-entrypoint-initdb.d`ç›®å½•ä¸‹çš„è„šæœ¬åˆå§‹åŒ–æ•°æ®åº“ï¼Œè„šæœ¬å¯ä»¥æ˜¯`.sh``.sql`å’Œ

`.sql.gz`è¿™ä¸‰ç§æ ¼å¼ã€‚

``` nginx
docker run -e MYSQL_ROOT_PASSWORD=123456 \
           -e MYSQL_DATABASE=ry \
					 -v /home/app/sql:/docker-entrypoint-initdb.d \
           -v ruoyi-data:/var/lib/mysql  \
        	 --network ruoyi-net \
           --name ruoyi-db \
           -d mysql:5.7 \
           --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
```

## éƒ¨ç½²åº”ç”¨

``` nginx
docker run -p 8080:8080 \
					 -v /home/app/ruoyi-admin.jar:/usr/local/src/ruoyi-admin.jar \
        	 --network ruoyi-net \
           --name ruoyi-java \
					 -d openjdk:8u342-jre \
           java -jar /usr/local/src/ruoyi-admin.jar
```

## è§£å†³ä¹±ç é—®é¢˜ï¼š

ä¹±ç é—®é¢˜æ˜¯å®¹å™¨ä¸­mysqlé»˜è®¤å­—ç¬¦é›†å¼•èµ·çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†é»˜è®¤å­—ç¬¦é›†æ”¹ä¸º`utf8mb4`ã€‚

å‚è€ƒï¼šhttps://github.com/docker-library/mysql/issues/131

å¯ä»¥è¿›å…¥å®¹å™¨ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ•°æ®åº“å­—ç¬¦é›†

``` nginx
docker exec -it ruoyi-db mysql -uroot -p

>show variables like '%character%';
```

::: warning æ³¨æ„

ç”±äºåˆ é™¤å®¹å™¨ä¸ä¼šåˆ é™¤å­˜å‚¨å·ï¼Œä¿®æ”¹å­—ç¬¦é›†éœ€è¦åˆ é™¤å­˜å‚¨å·ï¼Œä¸ç„¶å·²ç»å¯¼å…¥çš„æ•°æ®å­—ç¬¦é›†ä¸ä¼šå‘ç”Ÿæ”¹å˜

:::

åˆ é™¤å®¹å™¨å’Œå·

``` nginx
docker stop ruoyi-db
docker rm ruoyi-db
docker volume rm ruoyi-data
```

å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§è§£å†³æ–¹æ³•ï¼š

### 1.ä¿®æ”¹è¿è¡Œå‚æ•°

ä½¿ç”¨ç¯å¢ƒå˜é‡`LANG=C.UTF-8`è®¾ç½®å®¢æˆ·ç«¯å­—ç¬¦é›†

``` nginx
docker run  -e MYSQL_ROOT_PASSWORD=123456 \
            -e MYSQL_DATABASE=ry \
            -e LANG=C.UTF-8 \
            -v /home/app/sql:/docker-entrypoint-initdb.d \
            -v ruoyi-data:/var/lib/mysql  \
            --network ruoyi-net \
            --name ruoyi-db \
            -d mysql:5.7 \
            --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
```

**æˆ–è€…**

ä½¿ç”¨--skip-character-set-client-handshakeå¿½ç•¥å®¢æˆ·ç«¯å­—ç¬¦é›†ï¼Œä½¿ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å­—ç¬¦é›†ä¸€è‡´

``` nginx
docker run  -e MYSQL_ROOT_PASSWORD=123456 \
            -e MYSQL_DATABASE=ry \
            -v /home/app/sql:/docker-entrypoint-initdb.d \
            -v ruoyi-data:/var/lib/mysql  \
            --network ruoyi-net \
            --name ruoyi-db \
            -d mysql:5.7 \
            --skip-character-set-client-handshake --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci 
```

### 2.ä¿®æ”¹é…ç½®æ–‡ä»¶

ä¿®æ”¹`/home/mysql/mysql.cnf`

``` nginx
[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_general_ci
init-connect='SET NAMES utf8mb4'

[client]
default-character-set=utf8mb4

[mysql]
default-character-set=utf8mb4
```

å°†é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­

``` nginx
docker run -e MYSQL_ROOT_PASSWORD=123456 \
           -e MYSQL_DATABASE=ry \
           -v /home/mysql/mysql.cnf:/etc/mysql/conf.d/mysql.cnf:ro  \
					 -v /home/app/sql:/docker-entrypoint-initdb.d \
           -v ruoyi-data:/var/lib/mysql  \
        	 --network ruoyi-net \
           --name ruoyi-db \
           -d mysql:5.7 
```

[ä¸ƒã€docker composeå®¹å™¨ç¼–æ’ (yuque.com)](https://www.yuque.com/wukong-zorrm/xwas40/gzgrt1)

[ğŸ¥™ ç›®å½•æŒ‚è½½ - Docker å¿«é€Ÿå…¥é—¨ - æ˜“æ–‡æ¡£ (easydoc.net)](https://docker.easydoc.net/doc/81170005/cCewZWoN/kze7f0ZR)