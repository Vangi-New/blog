---
title: 安装Docker
date: 2024/03/29
---

## 1.Windows下安装Docker

::: warning 注意事项

容器主要使用linux内核技术，因此Windows下安装docker可能会有遇到各种问题，建议刚入门的同学先在linux虚拟机里安装docker，学完之后在windows下安装，免得遇到问题后，还没入门就放弃了。

:::

- **Docker Engine**

​		我们通常所说的docker，是指Docker Engine，它是一种容器化技术，用于创建和运行容器。

- **Docker Desktop**

​		Docker Desktop是一个用于操作docker的GUI图形界面化工具，它包含Docker Engine。

### 1.1 系统版本要求

::: warning 注意事项

如果是Windows 7、Windows8 用户，推荐在虚拟机中安装docker。

:::

在PowerShell中使用`winver`命令查看系统版本

-  Windows 11 
-  Windows 10 21H1 或更高版本

### 1.2 必要条件

1 在“任务管理器”的“性能”选项里查看虚拟化是否启用。如果没有，需要在BIOS中开启。

![img](https://cdn.nlark.com/yuque/0/2022/png/28915315/1660567166974-9b4a977f-ac9e-4d69-b66f-01351ecc1fb3.png)

2 安装“虚拟机平台”和 WSL

![img](https://cdn.nlark.com/yuque/0/2023/png/28915315/1673400408225-c66c1541-66c1-43fb-9e2d-889c0ec2c181.png)
或者以管理员身份运行以下命令：

``` powershell
Enable-WindowsOptionalFeature -Online -FeatureName VirtualMachinePlatform -All -NoRestart
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux -All -NoRestart
```

3 设置Hypervisor开机自动启动

一些程序（例如旧版本的Virtual Box或某些游戏）会禁用Hypervisor自动启动，可能会docker无法正常运行。

``` powershell
bcdedit /set hypervisorlaunchtype auto
```

4 安装WSL2内核更新包

- [适用于 x64 计算机的 WSL2 Linux 内核更新包](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)
- 或者直接在windows的微软商店里面下载Ubantu的长期支持版

5 将 WSL 2 设置为默认版本

``` powershell
wsl --set-default-version 2
```

重启系统。

### 1.3 安装Docker Desktop

下载[Docker Desktop for Windows](https://desktop.docker.com/win/main/amd64/Docker Desktop Installer.exe)进行安装。出现以下界面，安装成功。

![img](https://cdn.nlark.com/yuque/0/2022/png/28915315/1660567962026-9ecb1833-e79e-4c2d-bbb8-1bfd84b29485.png)

### 1.4 配置镜像站

由于访问docker hub网络比较慢，因此需要配置国内的容器仓库镜像站。

![mirrors.png](https://cdn.nlark.com/yuque/0/2022/png/28915315/1660568207471-a6449e68-af4e-4cc7-b7dc-4f333db80310.png?x-oss-process=image%2Fformat%2Cwebp)

``` json
{
  "builder": {
    "gc": {
      "defaultKeepStorage": "20GB",
      "enabled": true
    }
  },
  "experimental": false,
  "features": {
    "buildkit": true
  },
  "registry-mirrors": [
    "https://reg-mirror.qiniu.com/",
    "https://docker.mirrors.ustc.edu.cn/",
    "https://hub-mirror.c.163.com/"
  ]
}
```

### 1.5 注意事项

- 挂载路径

> 注意：windows下路径使用`\`作为分割符

```
docker run --rm -it -v D:\docker\data1:/work1 alpine
```

或者采用linux路径写法

```
docker run --rm -it -v /D/docker/data2:/work2 alpine
```

- dockerfile换行符

‎Docker 容器基于Linux运行环境，容器内文件必须使用 linux 样式的换行符 `\n`，不能使用windows换行符`\r\n`。

例如dockerfile文件，windows下的一些工具会默认使用windows换行符，可能导致这些文件在容器中显示语法错误。

## 2.linux下安装Docker

安装环境：CentOS 7.3+

### 如果之前安装了旧版docker，请先删除。

``` bash
sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
```

### 安装仓库

``` bash
sudo yum install -y yum-utils

sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
```

### 安装docker engine

``` bash
sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin
```

`docker-ce`：服务端

`docker-ce-cli`：客户端

客户端发出的指令交给服务端，服务端并不直接创建容器，而是交给 `containerd.in` 创建容器，销毁运行容器

`docker-compose-plugin`：容器编排工具

### 启动docker，运行hello world查看是否成功

``` bash
sudo systemctl start docker
sudo docker run hello-world
```

### 配置国内镜像仓库地址：

新建`/etc/docker/daemon.json`文件，输入如下内容：

``` bash
{
  "registry-mirrors": [
    "https://registry.docker-cn.com",
    "http://hub-mirror.c.163.com",
    "https://fsp2sfpr.mirror.aliyuncs.com/"
  ]
}
```

然后重启，配置开机启动

``` bash
sudo systemctl restart docker
sudo systemctl enable docker
sudo systemctl enable containerd
```

## 镜像加速源

| 镜像加速器          | 镜像加速器地址                       |
| ------------------- | ------------------------------------ |
| Docker 中国官方镜像 | https://registry.docker-cn.com       |
| DaoCloud 镜像站     | http://f1361db2.m.daocloud.io        |
| Azure 中国镜像      | https://dockerhub.azk8s.cn           |
| 科大镜像站          | https://docker.mirrors.ustc.edu.cn   |
| 阿里云              | https://ud6340vz.mirror.aliyuncs.com |
| 七牛云              | https://reg-mirror.qiniu.com         |
| 网易云              | https://hub-mirror.c.163.com         |
| 腾讯云              | https://mirror.ccs.tencentyun.com    |

```
"registry-mirrors": ["https://registry.docker-cn.com"]
```

![1.png](https://cos.easydoc.net/46901064/files/l25jdwrn.png)